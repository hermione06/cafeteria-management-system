<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Bounty Cafeteria{% endblock %}</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts - Fredoka -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
    
    <!-- Custom Bounty Style -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4FB3BF',
                        secondary: '#FFE66D',
                        accent: '#3BA5B0',
                    }
                }
            }
        }
    </script>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Background + Decorative Wrapper -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none z-0">
        <!-- Gradient Background -->
        <div class="absolute inset-0 bg-gradient-to-b from-[#cdffd8] to-[#94b9ff]"></div>

        <div class="wave-bottom">
            <svg 
                width="100%" 
                height="256" 
                style="position: absolute; bottom: 0; left: 0;" 
                viewBox="0 0 1440 256" 
                xmlns="http://www.w3.org/2000/svg"
                preserveAspectRatio="none"
            >
                <defs>
                    <clipPath id="waveClip">
                        <path d="M0,100 C400,200 800,0 1440,100 L1440,256 L0,256 Z"></path>
                    </clipPath>
                </defs>
                <rect width="100%" height="100%" fill="white" clip-path="url(#waveClip)"></rect>
            </svg>
        </div>

        <!-- Tropical Images -->
        <img src="https://media-public.canva.com/pkG0s/MAE2mopkG0s/1/s.png" 
            class="absolute left-[0px] top-[400px] w-[700px] rotate-[0deg] opacity-100">

        <img src="https://media-public.canva.com/N6Er4/MAEmSLN6Er4/1/t.png" 
            class="absolute right-[-80px] top-[90px] w-[400px] rotate-[169deg] opacity-100">

        <img src="https://media-public.canva.com/N6Er4/MAEmSLN6Er4/1/t.png" 
            class="absolute right-[-70px] top-[-160px] w-[500px] rotate-[-151deg] opacity-100">

        <img src="https://media-public.canva.com/kqKoo/MAFlcrkqKoo/1/s.png" 
            class="absolute left-[-10px] top-[500px] w-[450px] rotate-[0deg] opacity-100">
    </div>

    <!-- Navigation -->
    <nav class="bg-[#3fc7df] shadow-lg sticky top-0 z-50" style="font-family: 'Fredoka', sans-serif;">
        <div class="max-w-7xl mx-auto px-8 py-4 flex justify-between items-center text-white font-bold">
            <!-- Left -->
            <div class="flex space-x-10 tracking-wide flex-1">
                <a href="/">HOME</a>
                <a href="/menu">MENU</a>
            </div>

            <!-- Center -->
            <div class="text-lg tracking-wide flex-1 text-center">
                {% if session.user_id %}
                    WELCOME, {{ session.username|upper }}!
                {% else %}
                    WELCOME, GUEST!
                {% endif %}
            </div>

            <!-- Right -->
            <div class="flex space-x-10 tracking-wide flex-1 justify-end">
                {% if session.role == 'admin' %}
                    <a href="/orders">ORDERS</a>
                    <a href="/dashboard">DASHBOARD</a>
                {% elif session.user_id %}
                    <a href="/cart">CART</a>
                    <a href="/account">ACCOUNT</a>
                {% else %}
                    <a href="/login">LOGIN</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Flash Messages -->
    <div id="flashMessages" class="fixed top-20 right-4 z-50 space-y-2"></div>

    <!-- Main Content Wrapper -->
    <div class="relative z-10 pt-10">
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            {% block content %}{% endblock %}
        </main>
    </div>
    
    <!-- Footer -->
    <footer class="fixed bottom-0 left-0 w-full z-50">
        <div class="bg-[#3fc7df] h-2 hover:h-32 transition-all duration-500 overflow-hidden relative group">
            <div class="flex flex-col items-center justify-center h-full text-white opacity-0 group-hover:opacity-100 transition-opacity duration-500" style="font-family: 'Fredoka', sans-serif;">
                <p class="mb-2 text-lg tracking-wide font-bold">&copy; 2025 UFAZ CAFETERIA. ALL RIGHTS RESERVED.</p>
                <div class="flex space-x-4">
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Global API base URL
        const API_BASE = '/api';
        
        // Get token from localStorage
        function getToken() {
            return localStorage.getItem('access_token');
        }
        
        // Set token in localStorage
        function setToken(token) {
            localStorage.setItem('access_token', token);
        }
        
        // Remove token
        function removeToken() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
        }
        
        // Toggle user menu
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('hidden');
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('userMenu');
            const dropdown = document.getElementById('userDropdown');
            
            if (userMenu && dropdown && !userMenu.contains(event.target)) {
                dropdown.classList.add('hidden');
            }
        });
        
        // Logout function
        async function logout() {
            try {
                const token = getToken();
                if (token) {
                    await fetch(`${API_BASE}/auth/logout`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                }
            } catch (error) {
                console.error('Logout error:', error);
            } finally {
                removeToken();
                window.location.href = '/login';
            }
        }
        
        // Show flash message
        function showFlash(message, type = 'info') {
            const container = document.getElementById('flashMessages');
            const id = 'flash-' + Date.now();
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            const flash = document.createElement('div');
            flash.id = id;
            flash.className = `${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 fade-in min-w-[300px]`;
            flash.innerHTML = `
                <i class="fas ${icons[type]}"></i>
                <span class="flex-1">${message}</span>
                <button onclick="document.getElementById('${id}').remove()" class="text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(flash);
            
            setTimeout(() => {
                flash.remove();
            }, 5000);
        }
        
        // API request helper with auth
        async function apiRequest(endpoint, options = {}) {
            const token = getToken();
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    ...options,
                    headers
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Request failed');
                }
                
                return data;
            } catch (error) {
                showFlash(error.message, 'error');
                throw error;
            }
        }
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>