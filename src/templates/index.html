{% extends "base.html" %}

{% block title %}Home - Bounty Cafeteria{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-container">
    <!-- Gradient Background Box -->
    <div class="gradient-box"></div>
    
    <!-- Left Side: Text -->
    <div class="hero-left">
        <h1 class="bounty-title">bounty</h1>
        <p class="bounty-subtitle">UFAZ CAFETERIA ‚Äî MADE SIMPLE</p>
        <button class="announcements-btn" onclick="openAnnouncementsPopup()">View Announcements</button>
    </div>
    
    <!-- Right Side: Buttons -->
    <div class="hero-right">
        <div class="hero-buttons">
            {% if session.role == 'admin' %}
                <a href="/menu" class="hero-btn">MANAGE MENU</a>
                <a href="/orders" class="hero-btn">MANAGE ORDERS</a>
                <a href="/dashboard" class="hero-btn">DASHBOARD</a>
            {% elif session.user_id %}
                <a href="/menu" class="hero-btn">VIEW MENU</a>
                <a href="/orders" class="hero-btn">MY ORDER</a>
                <a href="/account" class="hero-btn">MY ACCOUNT</a>
            {% else %}
                <a href="/menu" class="hero-btn">VIEW MENU</a>
                <a href="/login" class="hero-btn">LOGIN/REGISTER</a>
                <button class="hero-btn" onclick="openWhyBountyPopup()">WHY BOUNTY?</button>
            {% endif %}
        </div>
    </div>
    
    <!-- Decorative Images -->
    <div class="decoration-images">
        <img src="https://media-public.canva.com/Vx7uQ/MAF-jBVx7uQ/1/s.png" 
             class="absolute left-[100px] top-[-70px] w-[550px] rotate-[0deg] opacity-100">
        
        <img src="https://media-public.canva.com/Xje4s/MAEGsyXje4s/1/s.png" 
             class="absolute left-[700px] top-[-160px] w-[400px] rotate-[0deg] opacity-100">
        
        <img src="https://media-public.canva.com/lZTR8/MAFbHMlZTR8/1/s.png" 
             class="absolute left-[1150px] top-[-100px] w-[650px] rotate-[-10deg] opacity-100">
    </div>
</div>

<!-- Why Bounty Popup -->
<div id="whyBountyPopup" class="popup-overlay" onclick="closePopupOnOverlay(event)">
    <div class="popup-content">
        <button class="popup-close" onclick="closeWhyBountyPopup()">&times;</button>
        <h2 class="popup-title">üçΩÔ∏è Why Choose Bounty?</h2>
        
        <div class="popup-feature">
            <div class="popup-icon">‚ö°</div>
            <div class="popup-feature-content">
                <h3>Quick & Easy Ordering</h3>
                <p>Order your favorite meals in seconds and skip the queue. Browse the menu, add items to your cart, and place your order from anywhere on campus.</p>
            </div>
        </div>
        
        <div class="popup-feature">
            <div class="popup-icon">ü•ó</div>
            <div class="popup-feature-content">
                <h3>Fresh & Quality Food</h3>
                <p>All meals are prepared fresh daily with quality ingredients. We ensure every dish meets the highest standards of taste and nutrition.</p>
            </div>
        </div>
        
        <div class="popup-feature">
            <div class="popup-icon">üîî</div>
            <div class="popup-feature-content">
                <h3>Real-time Order Tracking</h3>
                <p>Track your order status from preparation to pickup. Get instant notifications when your meal is ready to collect.</p>
            </div>
        </div>
        
        <div class="popup-feature">
            <div class="popup-icon">üí≥</div>
            <div class="popup-feature-content">
                <h3>Seamless Payments</h3>
                <p>Manage your account balance easily. Top up online and pay for your orders instantly without the hassle of carrying cash.</p>
            </div>
        </div>
        
        <div class="popup-feature">
            <div class="popup-icon">üéì</div>
            <div class="popup-feature-content">
                <h3>Made for UFAZ Students</h3>
                <p>Designed specifically for the UFAZ community. Enjoy a cafeteria experience tailored to your campus lifestyle.</p>
            </div>
        </div>
    </div>
</div>

<!-- Announcements Popup -->
<div id="announcementsPopup" class="popup-overlay" onclick="closePopupOnOverlay(event)">
    <div class="popup-content">
        <button class="popup-close" onclick="closeAnnouncementsPopup()">&times;</button>
        <h2 class="popup-title">üì¢ Announcements</h2>
        <div id="announcementsPopupContent">
            <!-- Announcements will be loaded here -->
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Popup functions
    function openWhyBountyPopup() {
        document.getElementById('whyBountyPopup').classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeWhyBountyPopup() {
        document.getElementById('whyBountyPopup').classList.remove('active');
        document.body.style.overflow = 'auto';
    }
    
    function openAnnouncementsPopup() {
        loadAnnouncementsPopup();
        document.getElementById('announcementsPopup').classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeAnnouncementsPopup() {
        document.getElementById('announcementsPopup').classList.remove('active');
        document.body.style.overflow = 'auto';
    }
    
    function closePopupOnOverlay(event) {
        if (event.target.id === 'whyBountyPopup') {
            closeWhyBountyPopup();
        }
        if (event.target.id === 'announcementsPopup') {
            closeAnnouncementsPopup();
        }
    }
    
    // Close popup with Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeWhyBountyPopup();
            closeAnnouncementsPopup();
        }
    });
    
    // Smooth scroll to announcements section (kept for compatibility)
    function scrollToAnnouncements(event) {
        event.preventDefault();
        const element = document.getElementById('announcementsSection');
        if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
    
    // Load announcements
    async function loadAnnouncements() {
        try {
            const response = await fetch(`${API_BASE}/announcements`);
            const data = await response.json();
            
            if (data.announcements && data.announcements.length > 0) {
                const container = document.getElementById('announcementsSection');
                const activeAnnouncements = data.announcements.filter(a => 
                    a.title !== "No announcements yet"
                );
                
                if (activeAnnouncements.length > 0) {
                    container.innerHTML = `
                        <div class="bg-white rounded-3xl p-8 shadow-xl max-w-5xl mx-auto border-l-8" style="border-color: #4FB3BF;">
                            <h3 class="text-3xl font-bold mb-6" style="font-family: 'Fredoka', sans-serif; color: #2D3748;">
                                üì¢ Announcements
                            </h3>
                            <div class="space-y-4">
                                ${activeAnnouncements.map(ann => `
                                    <div class="bg-gray-50 p-5 rounded-2xl">
                                        <h4 class="font-bold text-lg" style="font-family: 'Fredoka', sans-serif; color: #2D3748;">${ann.title}</h4>
                                        <p class="mt-2" style="font-family: 'Fredoka', sans-serif; color: #4A5568;">${ann.message}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            }
        } catch (error) {
            console.error('Error loading announcements:', error);
        }
    }
    
    // Load announcements for popup
    async function loadAnnouncementsPopup() {
        try {
            const response = await fetch(`${API_BASE}/announcements`);
            const data = await response.json();
            
            const container = document.getElementById('announcementsPopupContent');
            
            if (data.announcements && data.announcements.length > 0) {
                const activeAnnouncements = data.announcements.filter(a => 
                    a.title !== "No announcements yet"
                );
                
                if (activeAnnouncements.length > 0) {
                    container.innerHTML = activeAnnouncements.map(ann => `
                        <div class="popup-feature">
                            <div class="popup-icon">üì¢</div>
                            <div class="popup-feature-content">
                                <h3>${ann.title}</h3>
                                <p>${ann.message}</p>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="popup-feature">
                            <div class="popup-icon">üì≠</div>
                            <div class="popup-feature-content">
                                <h3>No Announcements</h3>
                                <p>There are no announcements at this time. Check back later!</p>
                            </div>
                        </div>
                    `;
                }
            } else {
                container.innerHTML = `
                    <div class="popup-feature">
                        <div class="popup-icon">üì≠</div>
                        <div class="popup-feature-content">
                            <h3>No Announcements</h3>
                            <p>There are no announcements at this time. Check back later!</p>
                        </div>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading announcements popup:', error);
            const container = document.getElementById('announcementsPopupContent');
            container.innerHTML = `
                <div class="popup-feature">
                    <div class="popup-icon">‚ö†Ô∏è</div>
                    <div class="popup-feature-content">
                        <h3>Error Loading Announcements</h3>
                        <p>Unable to load announcements. Please try again later.</p>
                    </div>
                </div>
            `;
        }
    }
    
    // Load data on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadAnnouncements();
    });
</script>
{% endblock %}