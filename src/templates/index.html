{% extends "base.html" %}

{% block title %}Home - Bounty Cafeteria{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-container">
    <!-- Gradient Background Box -->
    <div class="gradient-box"></div>
    
    <!-- Left Side: Text -->
    <div class="hero-left">
        <h1 class="bounty-title">bounty</h1>
        <p class="bounty-subtitle">UFAZ CAFETERIA ‚Äî MADE SIMPLE</p>
        <button class="announcements-btn" onclick="openAnnouncementsPopup()">View Announcements</button>
        <button class="announcements-btn" onclick="openPopularItemsPopup()" style="margin-top: 10px;">Popular Items</button>
    </div>
    
    <!-- Right Side: Buttons -->
    <div class="hero-right">
        <div class="hero-buttons">
            {% if session.role == 'admin' %}
                <a href="/menu" class="hero-btn">MANAGE MENU</a>
                <a href="/orders" class="hero-btn">MANAGE ORDERS</a>
                <a href="/dashboard" class="hero-btn">DASHBOARD</a>
            {% elif session.user_id %}
                <a href="/menu" class="hero-btn">VIEW MENU</a>
                <a href="/orders" class="hero-btn">MY ORDER</a>
                <a href="/account" class="hero-btn">MY ACCOUNT</a>
            {% else %}
                <a href="/menu" class="hero-btn">VIEW MENU</a>
                <a href="/login" class="hero-btn">LOGIN/REGISTER</a>
                <button class="hero-btn" onclick="openWhyBountyPopup()">WHY BOUNTY?</button>
            {% endif %}
        </div>
    </div>
    
    <!-- Decorative Images -->
    <div class="decoration-images">
        <img src="https://media-public.canva.com/Vx7uQ/MAF-jBVx7uQ/1/s.png" 
             class="absolute left-[100px] top-[-70px] w-[550px] rotate-[0deg] opacity-100">
        
        <img src="https://media-public.canva.com/Xje4s/MAEGsyXje4s/1/s.png" 
             class="absolute left-[700px] top-[-160px] w-[400px] rotate-[0deg] opacity-100">
        
        <img src="https://media-public.canva.com/lZTR8/MAFbHMlZTR8/1/s.png" 
             class="absolute left-[1150px] top-[-100px] w-[650px] rotate-[-10deg] opacity-100">
    </div>
</div>



<!-- Why Bounty Popup -->
<div id="whyBountyPopup" class="popup-overlay" onclick="closePopupOnOverlay(event)">
    <div class="popup-content">
        <button class="popup-close" onclick="closeWhyBountyPopup()">&times;</button>
        <h2 class="popup-title">üçΩÔ∏è Why Choose Bounty?</h2>
        
        <div class="popup-feature">
            <div class="popup-icon">‚ö°</div>
            <div class="popup-feature-content">
                <h3>Quick & Easy Ordering</h3>
                <p>Order your favorite meals in seconds and skip the queue. Browse the menu, add items to your cart, and place your order from anywhere on campus.</p>
            </div>
        </div>
        
        <div class="popup-feature">
            <div class="popup-icon">ü•ó</div>
            <div class="popup-feature-content">
                <h3>Fresh & Quality Food</h3>
                <p>All meals are prepared fresh daily with quality ingredients. We ensure every dish meets the highest standards of taste and nutrition.</p>
            </div>
        </div>
        
        <div class="popup-feature">
            <div class="popup-icon">üîî</div>
            <div class="popup-feature-content">
                <h3>Real-time Order Tracking</h3>
                <p>Track your order status from preparation to pickup. Get instant notifications when your meal is ready to collect.</p>
            </div>
        </div>
        
        <div class="popup-feature">
            <div class="popup-icon">üí≥</div>
            <div class="popup-feature-content">
                <h3>Seamless Payments</h3>
                <p>Manage your account balance easily. Top up online and pay for your orders instantly without the hassle of carrying cash.</p>
            </div>
        </div>
        
        <div class="popup-feature">
            <div class="popup-icon">üéì</div>
            <div class="popup-feature-content">
                <h3>Made for UFAZ Students</h3>
                <p>Designed specifically for the UFAZ community. Enjoy a cafeteria experience tailored to your campus lifestyle.</p>
            </div>
        </div>
    </div>
</div>

<!-- Announcements Popup -->
<div id="announcementsPopup" class="popup-overlay" onclick="closePopupOnOverlay(event)">
    <div class="popup-content">
        <button class="popup-close" onclick="closeAnnouncementsPopup()">&times;</button>
        <h2 class="popup-title">üì¢ Announcements</h2>
        <div id="announcementsPopupContent">
            <!-- Announcements will be loaded here -->
        </div>
    </div>
</div>

<!-- Popular Items Popup -->
<div id="popularItemsPopup" class="popup-overlay" onclick="closePopupOnOverlay(event)">
    <div class="popup-content">
        <button class="popup-close" onclick="closePopularItemsPopup()">&times;</button>
        <h2 class="popup-title">üçΩÔ∏è Popular Items</h2>
        <div id="popularItemsPopupContent" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Popular items will be loaded here -->
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Popup functions
    function openWhyBountyPopup() {
        document.getElementById('whyBountyPopup').classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeWhyBountyPopup() {
        document.getElementById('whyBountyPopup').classList.remove('active');
        document.body.style.overflow = '';
    }
    
    function openAnnouncementsPopup() {
        loadAnnouncementsPopup();
        document.getElementById('announcementsPopup').classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeAnnouncementsPopup() {
        document.getElementById('announcementsPopup').classList.remove('active');
        document.body.style.overflow = '';
    }
    
    function openPopularItemsPopup() {
        loadPopularItemsPopup();
        document.getElementById('popularItemsPopup').classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closePopularItemsPopup() {
        document.getElementById('popularItemsPopup').classList.remove('active');
        document.body.style.overflow = '';
    }
    
    function closePopupOnOverlay(event) {
        if (event.target.id === 'whyBountyPopup') {
            closeWhyBountyPopup();
        }
        if (event.target.id === 'announcementsPopup') {
            closeAnnouncementsPopup();
        }
        if (event.target.id === 'popularItemsPopup') {
            closePopularItemsPopup();
        }
    }
    
    // Close popup with Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeWhyBountyPopup();
            closeAnnouncementsPopup();
            closePopularItemsPopup();
        }
    });
    
    // Load announcements for popup
    async function loadAnnouncementsPopup() {
        try {
            const response = await fetch(`${API_BASE}/announcements`);
            const data = await response.json();
            
            const container = document.getElementById('announcementsPopupContent');
            
            if (data.announcements && data.announcements.length > 0) {
                const activeAnnouncements = data.announcements.filter(a => 
                    a.title !== "No announcements yet"
                );
                
                if (activeAnnouncements.length > 0) {
                    container.innerHTML = activeAnnouncements.map(ann => `
                        <div class="popup-feature">
                            <div class="popup-icon">üì¢</div>
                            <div class="popup-feature-content">
                                <h3>${ann.title}</h3>
                                <p>${ann.message}</p>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="popup-feature">
                            <div class="popup-icon">üì≠</div>
                            <div class="popup-feature-content">
                                <h3>No Announcements</h3>
                                <p>There are no announcements at this time. Check back later!</p>
                            </div>
                        </div>
                    `;
                }
            } else {
                container.innerHTML = `
                    <div class="popup-feature">
                        <div class="popup-icon">üì≠</div>
                        <div class="popup-feature-content">
                            <h3>No Announcements</h3>
                            <p>There are no announcements at this time. Check back later!</p>
                        </div>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading announcements popup:', error);
            const container = document.getElementById('announcementsPopupContent');
            container.innerHTML = `
                <div class="popup-feature">
                    <div class="popup-icon">‚ö†Ô∏è</div>
                    <div class="popup-feature-content">
                        <h3>Error Loading Announcements</h3>
                        <p>Unable to load announcements. Please try again later.</p>
                    </div>
                </div>
            `;
        }
    }
    
    // Load popular items for popup
    async function loadPopularItemsPopup() {
        try {
            const response = await fetch(`${API_BASE}/menu?available=true&per_page=6`);
            const data = await response.json();
            
            const container = document.getElementById('popularItemsPopupContent');
            
            if (data.items && data.items.length > 0) {
                container.innerHTML = data.items.map(item => `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition transform hover:-translate-y-2">
                        <div class="h-32 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                            <i class="fas fa-utensils text-5xl text-white"></i>
                        </div>
                        <div class="p-4">
                            <h3 class="text-lg font-bold mb-2" style="font-family: 'Fredoka', sans-serif; color: #2D3748;">${item.name}</h3>
                            <p class="text-gray-600 mb-3 text-sm" style="font-family: 'Fredoka', sans-serif;">${item.description || 'Delicious and fresh'}</p>
                            <div class="flex justify-between items-center">
                                <span class="text-xl font-bold" style="color: #4FB3BF; font-family: 'Fredoka', sans-serif;">‚Çº${item.price.toFixed(2)}</span>
                                <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs" style="font-family: 'Fredoka', sans-serif;">
                                    <i class="fas fa-check-circle mr-1"></i> Available
                                </span>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = `
                    <div class="col-span-full text-center text-gray-500 py-12">
                        <i class="fas fa-utensils text-6xl mb-4"></i>
                        <p class="text-xl" style="font-family: 'Fredoka', sans-serif;">No items available at the moment</p>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading popular items popup:', error);
            const container = document.getElementById('popularItemsPopupContent');
            container.innerHTML = `
                <div class="col-span-full text-center text-gray-500 py-12">
                    <i class="fas fa-exclamation-triangle text-6xl mb-4"></i>
                    <p class="text-xl" style="font-family: 'Fredoka', sans-serif;">Unable to load items. Please try again later.</p>
                </div>
            `;
        }
    }
    
    // Load popular items
    async function loadPopularItems() {
        try {
            const response = await fetch(`${API_BASE}/menu?available=true&per_page=4`);
            const data = await response.json();
            
            const container = document.getElementById('popularItems');
            
            if (data.items && data.items.length > 0) {
                container.innerHTML = data.items.map(item => `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition transform hover:-translate-y-2">
                        <div class="h-48 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                            <i class="fas fa-utensils text-6xl text-white"></i>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2" style="font-family: 'Fredoka', sans-serif; color: #2D3748;">${item.name}</h3>
                            <p class="text-gray-600 mb-4 text-sm" style="font-family: 'Fredoka', sans-serif;">${item.description || 'Delicious and fresh'}</p>
                            <div class="flex justify-between items-center">
                                <span class="text-2xl font-bold" style="color: #4FB3BF; font-family: 'Fredoka', sans-serif;">‚Çº${item.price.toFixed(2)}</span>
                                <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm" style="font-family: 'Fredoka', sans-serif;">
                                    <i class="fas fa-check-circle mr-1"></i> Available
                                </span>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = `
                    <div class="col-span-full text-center text-gray-500 py-12">
                        <i class="fas fa-utensils text-6xl mb-4"></i>
                        <p class="text-xl" style="font-family: 'Fredoka', sans-serif;">No items available at the moment</p>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error loading popular items:', error);
            const container = document.getElementById('popularItems');
            container.innerHTML = `
                <div class="col-span-full text-center text-gray-500 py-12">
                    <i class="fas fa-exclamation-triangle text-6xl mb-4"></i>
                    <p class="text-xl" style="font-family: 'Fredoka', sans-serif;">Unable to load items. Please try again later.</p>
                </div>
            `;
        }
    }
    
    // Load data on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadPopularItems();
    });
</script>
{% endblock %}