{% extends "base_unlogged.html" %}
{% block title %}Register - Cafeteria{% endblock %}

{% block content %}
<section style="display: flex; justify-content: center; align-items: center; min-height: 75vh; padding: 1rem;">
  <div class="card" style="max-width: 420px; width: 100%;">
    <h2 style="text-align: center;">Register Account</h2>

    <!-- STEP 1: Email input -->
    <div id="step-email">
      <p>Enter your university email address to receive a verification code.</p>
      <form id="email-form" method="POST" action="{{ url_for('send_verification_code') }}" style="display: flex; flex-direction: column; gap: 1rem;">
        <input type="email" id="email" name="email" placeholder="Your Email" required
               style="padding: 0.6rem; border-radius: var(--radius); border: 1px solid #ccc;">
        <button type="submit" class="btn">Send Code</button>
      </form>
    </div>

    <!-- STEP 2: Code verification -->
    <div id="step-code" style="display: none;">
      <p>Enter the 6-digit verification code we sent to your email.</p>
      <form id="code-form" method="POST" action="{{ url_for('verify_code') }}" style="display: flex; flex-direction: column; gap: 1rem;">
        <input type="text" id="code" name="code" placeholder="Verification Code" required
               style="padding: 0.6rem; border-radius: var(--radius); border: 1px solid #ccc;">
        <button type="submit" class="btn">Verify</button>
      </form>
    </div>

    <!-- STEP 3: Password setup -->
    <div id="step-password" style="display: none;">
      <p>Your email <strong id="verified-email"></strong> has been verified âœ…</p>
      <form id="register-form" method="POST" action="{{ url_for('register_user') }}" style="display: flex; flex-direction: column; gap: 1rem;">
        <input type="hidden" name="email" id="final-email">
        <input type="password" id="password" name="password" placeholder="Enter Password" required
               style="padding: 0.6rem; border-radius: var(--radius); border: 1px solid #ccc;">
        <input type="password" id="confirm-password" name="confirm_password" placeholder="Confirm Password" required
               style="padding: 0.6rem; border-radius: var(--radius); border: 1px solid #ccc;">
        <button type="submit" class="btn">Register</button>
      </form>
    </div>

    <p style="text-align: center; margin-top: 1rem;">
      Already have an account? <a href="{{ url_for('login_page') }}" style="color: var(--bounty-blue); text-decoration: none;">Login here</a>
    </p>
  </div>
</section>

<!-- External JS file -->
<script src="{{ url_for('static', filename='js/register.js') }}"></script>
{% endblock %}